version: "3.7"

services:
  backend:
    image: registry.bjarke.xyz/shoppinglistv4-backend
    build:
      context: ./
    deploy:
      replicas: 2
    networks:
      - shoppinglistv4
      - swarm-overlay
      - postgres

  worker:
    image: registry.bjarke.xyz/shoppinglistv4-backend
    entrypoint: /shoppinglist-backend-worker
    build:
      context: ./
    deploy:
      replicas: 2
    networks:
      - shoppinglistv4
      - swarm-overlay
      - postgres

  redis:
    image: redis:alpine
    networks:
      - shoppinglistv4

networks:
  postgres:
    external: true
    name: postgres_prod_postgres-prod
  shoppinglistv4:
    driver: overlay
  swarm-overlay:
    external: true
    name: swarm-overlay
